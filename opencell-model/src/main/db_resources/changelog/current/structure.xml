<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">


    <changeSet id="#2428_20180105" author="EdwardPLegaspi">
        <addColumn tableName="adm_notif_webhooks">
            <column name="http_protocol" type="varchar(10)" />
        </addColumn>
        <sql>UPDATE ${db.schema}.adm_notif_webhooks SET http_protocol='HTTP'</sql>
        <addNotNullConstraint tableName="adm_notif_webhooks" columnName="http_protocol" columnDataType="varchar(10)" />
    </changeSet>

    <changeSet id="#3170_20180119 Add payment method to invoice" author="EdwardPLegaspi">
        <addColumn tableName="billing_invoice">
            <column name="payment_method_id" type="bigint" />
        </addColumn>
    </changeSet>

    <changeSet id="#2449_20180125" author="EdwardPLegaspi">
        <addColumn tableName="cat_price_plan_matrix">
            <column name="rating_el" type="varchar(2000)" />
        </addColumn>
    </changeSet>


    <changeSet id="#3196_20180131" author="AndriusKarpavicius">
        <modifyDataType tableName="billing_charge_instance" columnName="termination_date" newDataType="datetime" />
        <modifyDataType tableName="billing_charge_instance" columnName="charge_date" newDataType="datetime" />
    </changeSet>

    <changeSet id="#2819_20180212" author="AbdelmounaimAkadid">
        <addColumn tableName="crm_seller">
            <column name="email" type="varchar(2000)" />
            <column name="fax" type="varchar(2000)" />
            <column name="mobile" type="varchar(2000)" />
            <column name="phone" type="varchar(2000)" />
        </addColumn>
    </changeSet>

    <changeSet id="#2792_20170919" author="AndriusKarpavicius">
        <sql>update ${db.schema}.cat_usage_charge_template set filter_expression=null where filter_expression=''</sql>
        <sql>update ${db.schema}.cat_usage_charge_template set filter_param_1=null where filter_param_1=''</sql>
        <sql>update ${db.schema}.cat_usage_charge_template set filter_param_2=null where filter_param_2=''</sql>
        <sql>update ${db.schema}.cat_usage_charge_template set filter_param_3=null where filter_param_3=''</sql>
        <sql>update ${db.schema}.cat_usage_charge_template set filter_param_4=null where filter_param_4=''</sql>

        <sql>update ${db.schema}.cat_triggered_edr set condition_el=null where condition_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set param_1_el=null where param_1_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set param_2_el=null where param_2_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set param_3_el=null where param_3_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set param_4_el=null where param_4_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set quantity_el=null where quantity_el=''</sql>
        <sql>update ${db.schema}.cat_triggered_edr set subscription_el=null where subscription_el=''</sql>
    </changeSet>


    <changeSet id="#2792_20180110" author="AndriusKarpavicius">
        <sql>update ${db.schema}.cat_price_plan_matrix set criteria_1=null where criteria_1=''</sql>
        <sql>update ${db.schema}.cat_price_plan_matrix set criteria_2=null where criteria_2=''</sql>
        <sql>update ${db.schema}.cat_price_plan_matrix set criteria_3=null where criteria_3=''</sql>
        <sql>update ${db.schema}.cat_price_plan_matrix set criteria_el=null where criteria_el=''</sql>
        <sql>update ${db.schema}.cat_price_plan_matrix set amount_without_tax_el=null where amount_without_tax_el=''</sql>
        <sql>update ${db.schema}.cat_price_plan_matrix set amount_with_tax_el=null where amount_with_tax_el=''</sql>

        <sql>CREATE INDEX cat_price_plan_event_c_index ON ${db.schema}.cat_price_plan_matrix(event_code)</sql>
        <sql>CREATE INDEX medina_access_user_id_index ON ${db.schema}.medina_access(acces_user_id)</sql>
    </changeSet>

    <changeSet id="#2792_20180119" author="AndriusKarpavicius">
        <sql>CREATE INDEX bc_instance_sub_id ON ${db.schema}.billing_charge_instance(subscription_id)</sql>
        <sql>CREATE INDEX counter_period_ci_id ON ${db.schema}.billing_counter_period(counter_instance_id)</sql>
        <addColumn tableName="billing_usage_charge_inst">
            <column defaultValueNumeric="1" name="priority" type="int4" />
        </addColumn>
    </changeSet>

    <changeSet id="#2792_20180119_migration_P" author="AndriusKarpavicius" dbms="postgresql">
        <sql>update ${db.schema}.billing_usage_charge_inst set priority = cat_usage_charge_template.priority from ${db.schema}.billing_charge_instance, ${db.schema}.cat_usage_charge_template where billing_charge_instance.id=billing_usage_charge_inst.id and
            billing_charge_instance.charge_template_id=cat_usage_charge_template.id</sql>
    </changeSet>

    <changeSet id="#2792_20180119_migration_M" author="AndriusKarpavicius" dbms="mysql">
        <sql>update ${db.schema}.billing_usage_charge_inst join ${db.schema}.billing_charge_instance on billing_charge_instance.id=billing_usage_charge_inst.id join ${db.schema}.cat_usage_charge_template on
            billing_charge_instance.charge_template_id=cat_usage_charge_template.id set billing_usage_charge_inst.priority = cat_usage_charge_template.priority</sql>
    </changeSet>

    <changeSet id="#2894_20180129" author="smichea">
        <addColumn tableName="meveo_job_instance">
            <column name="provider" type="varchar(255)"></column>
        </addColumn>
    </changeSet>

</databaseChangeLog> 