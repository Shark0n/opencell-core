<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="AbdelmounaimAkadid" id="#3224_16022018">
        <insert tableName="adm_role">
            <column name="id" valueNumeric="-6" />
            <column name="version" valueNumeric="0" />
            <column name="role_description" value="Customer care user" />
            <column name="role_name" value="CUSTOMER_CARE_USER" />
        </insert>
        <insert tableName="adm_role_role">
            <column name="role_id" valueNumeric="-6" />
            <column name="child_role_id" valueNumeric="-3" />
        </insert>
        <insert tableName="adm_role_permission">
            <column name="role_id" valueNumeric="-6" />
            <column name="permission_id" valueNumeric="14" />
        </insert>
        <insert tableName="adm_role_permission">
            <column name="role_id" valueNumeric="-6" />
            <column name="permission_id" valueNumeric="1" />
        </insert>
    </changeSet>
	
	<changeSet id="#3260_20180227 - Add finance roles" author="EdwardPLegaspi">
		<insert tableName="adm_role">
            <column name="id" value="-7" />
            <column name="version" value="0" />
            <column name="role_description" value="Finance Management" />
            <column name="role_name" value="financeManagement" />
        </insert>
        <insert tableName="adm_role">
            <column name="id" value="-8" />
            <column name="version" value="0" />
            <column name="role_description" value="Finance Visualization" />
            <column name="role_name" value="financeVisualization" />
        </insert>
        <insert tableName="adm_user_role">
        	<column name="user_id" value="-1"></column>
        	<column name="role_id" value="-7"></column>
        </insert>
        <insert tableName="adm_user_role">
        	<column name="user_id" value="-1"></column>
        	<column name="role_id" value="-8"></column>
        </insert>
	</changeSet>
	<changeSet author="anasseh" id="#3167_20022018">
	    <sql>update ${db.schema.adapted}ar_payment_gateway set description ='Ingenico API Connect OGONE for Sepa payments', code='INGENICO_OGONE_SEPA', uuid='gateway_INGENICO_ONGONE' ,disabled=0, trading_currency_id = -1 , payment_method ='DIRECTDEBIT' where id =-1</sql> 
	    <sql>delete from ${db.schema.adapted}ar_payment_gateway where id =-2</sql> 
	    <sql>delete from ${db.schema.adapted}ar_payment_gateway where id =-3</sql>   
	   	<insert tableName="ar_payment_gateway">
			<column name="id" valueNumeric="-2" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueNumeric="0" />
			<column name="created" valueDate="now()" />
			<column name="code" value="SLIMPAY_SEPA" />
			<column name="description" value="Slimpay for Sepa payments" />
			<column name="type" value="NATIF" />
			<column name="payment_method" value="DIRECTDEBIT" />
			<column name="implementation_class_name" value="org.meveo.service.payments.impl.SlimpayGatewayPayment" />
			<column name="trading_currency_id" value="-2" /><!-- EUR -->
			<column name="uuid" value="gateway_SLIMPAY" />
		</insert>  	
	   	<insert tableName="ar_payment_gateway">
			<column name="id" valueNumeric="-3" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueNumeric="0" />
			<column name="created" valueDate="now()" />
			<column name="code" value="INGENICO_OGONE_CARD" />
			<column name="description" value="Ingenico API Connect OGONE for Card payments" />
			<column name="type" value="NATIF" />
			<column name="payment_method" value="CARD" />
			<column name="implementation_class_name" value="org.meveo.service.payments.impl.SlimpayGatewayPayment" />
			<column name="trading_currency_id" value="-2" /><!-- EUR -->
			<column name="uuid" value="gateway_SLIMPAY" />
		</insert> 			 
    </changeSet>
    <changeSet author="anasseh" id="#3110_08032018">
   		 <sql>delete from ${db.schema.adapted}crm_provider_pay_methods where payment_method='NONE'</sql>   
    </changeSet>
    
    <changeSet id="#3234_13032018_1 - Homogenization of Account Operation types" author="anansseh" dbms="mysql">
	    <sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','445510000','TAX_VAT_00','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','445510000','TAX_VAT_05','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','445510000','TAX_VAT_20','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','445510000','TAX_VAT_10','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'512010000','411000000','REJ_CRD','Rejected payment - card','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'512010000','411000000','REJ_RCR','Rejected refund - card','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'512010000','411000000','REJ_RDD','Rejected refund - direct debit','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','709000000','INV_REB','Invoice - rebate sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','709000000','INV_DIS','Invoice - discount sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'411000000','701000000','INV_CRN','Invoice - credit note sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (0,0,CURRENT_TIMESTAMP(),'512010000','411000000','REF_TIP','Refund - TIP','DEBIT','opencell.admin')</sql>		
    </changeSet>
     
    <changeSet id="#3234_13032018_2 - Homogenization of Account Operation types" author="anansseh" dbms="postgresql">
	    <sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','445510000','TAX_VAT_00','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','445510000','TAX_VAT_05','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','445510000','TAX_VAT_20','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','445510000','TAX_VAT_10','Tax - VAT','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'512010000','411000000','REJ_CRD','Rejected payment - card','DEBIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'512010000','411000000','REJ_RCR','Rejected refund - card','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'512010000','411000000','REJ_RDD','Rejected refund - direct debit','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','709000000','INV_REB','Invoice - rebate sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','709000000','INV_DIS','Invoice - discount sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'411000000','701000000','INV_CRN','Invoice - credit note sub-item','CREDIT','opencell.admin')</sql>
		<sql>insert into ${db.schema.adapted}ar_occ_template (id,version,disabled,created,account_code,account_code_client_side,code, description,occ_category,creator) values (nextval('${db.schema.adapted}ar_occ_template_seq'),0,0,current_timestamp,'512010000','411000000','REF_TIP','Refund - TIP','DEBIT','opencell.admin')</sql>		
    </changeSet>
    <changeSet id="#3234_13032018_3 - Homogenization of Account Operation types" author="anansseh">
        <sql>update ${db.schema.adapted}ar_occ_template set code='INV_STD', description='Standard invoice sub-item', account_code='411000000', account_code_client_side='445510000' , creator = 'opencell.admin' where code ='FA_FACT'</sql>
		<sql>delete from ${db.schema.adapted}ar_occ_template where code ='OD_PREL'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='INV_FEE', description='Fee - late payment', account_code='411000000', account_code_client_side='763100000' , creator = 'opencell.admin' where code ='OD_PIMP'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_TIP', description='Payment - TIP', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RG_TIP'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_CHK', description='Payment - check', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RG_CHQ'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_DDT', description='Payment - direct debit', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RG_PLVT'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_CRD', description='Payment - card', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RG_CARD'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_DEP', description='Other - deposit', account_code='512010000', account_code_client_side='419110000', creator = 'opencell.admin' where code ='OD_ACPT'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_NID', description='Other - unidentified payment', account_code='512010000', account_code_client_side='419120000', creator = 'opencell.admin' where code ='RG_CHQNI'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='PAY_REC', description='Other - unidentified payment', account_code='512010000', account_code_client_side='419120000', creator = 'opencell.admin' where code ='RG_VIRTNI'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REF_CHK', description='Refund - check', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RB_CHQ'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REF_DDT', description='Refund - direct debit', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RB_PLVT'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REF_CRD', description='Refund - card', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='RF_CARD'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REJ_CHK', description='Rejected payment - check', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='IP_CHQ'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REJ_DDT', description='Rejected payment - direct debit', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='IP_PLVT'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='REJ_TIP', description='Rejected payment - TIP', account_code='512010000', account_code_client_side='411000000', creator = 'opencell.admin' where code ='IP_TIP'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='RND_EXP', description='Expense - payment rounding', account_code='658100000', account_code_client_side='411000000' , occ_category='DEBIT', creator = 'opencell.admin' where code ='OD_PERT'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='RND_INC', description='Income - payment rounding', account_code='758100000', account_code_client_side='411000000' , occ_category='CREDIT' , creator = 'opencell.admin' where code ='OD_PROF'</sql>
		<sql>update ${db.schema.adapted}ar_occ_template set code='EXP_WRT', description='Expense - bad debt write-off', account_code='654100000', account_code_client_side='411000000' , occ_category='DEBIT', creator = 'opencell.admin' where code ='OD_PERT'</sql>
		<sql>update ${db.schema.adapted}billing_invoice_type set occ_templ_negative_id = (select id from ${db.schema.adapted}ar_occ_template where code = 'INV_CRN') where code = 'COM'</sql>
		<sql>update ${db.schema.adapted}billing_invoice_type set occ_template_id = (select id from ${db.schema.adapted}ar_occ_template where code = 'INV_CRN') where code = 'ADJ'</sql>
		<sql>delete from ${db.schema.adapted}ar_occ_template where code ='FA_ADJ'</sql>
		<sql>delete from ${db.schema.adapted}ar_occ_template where code ='FA_N_FACT'</sql>
    </changeSet>
</databaseChangeLog>